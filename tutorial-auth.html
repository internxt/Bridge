<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Storj Bridge Tutorial: API Authentication</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<script src="scripts/highlight.min.js"></script>

	<link type="text/css" rel="stylesheet" href="styles/site.storj.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" style="background-image:url(img/storj-bridge.svg)"  href="index.html">Storj Bridge</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-storj-bridge.html">storj-bridge</a></li><li><a href="module-storj-bridge_constants.html">storj-bridge/constants</a></li><li><a href="module-storj-bridge_logger.html">storj-bridge/logger</a></li><li><a href="module-storj-bridge_utils.html">storj-bridge/utils</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="BucketsRouter.html">BucketsRouter</a></li><li><a href="Config.html">Config</a></li><li><a href="ContactsRouter.html">ContactsRouter</a></li><li><a href="Engine.html">Engine</a></li><li><a href="FramesRouter.html">FramesRouter</a></li><li><a href="PublicKeysRouter.html">PublicKeysRouter</a></li><li><a href="ReportsRouter.html">ReportsRouter</a></li><li><a href="Router.html">Router</a></li><li><a href="Server.html">Server</a></li><li><a href="StripeRouter.html">StripeRouter</a></li><li><a href="UsersRouter.html">UsersRouter</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-auth.html">API Authentication</a></li><li><a href="tutorial-config_.html">Configuring the Bridge</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#Cleaner">Cleaner</a></li><li><a href="global.html#Monitor">Monitor</a></li>
				</ul>
			</li>
			
		</ul>
		<div class="col-sm-3 col-md-4">
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                    <div class="input-group-btn">
                        <button class="btn btn-primary" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
            </form>
        </div>
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>API Authentication</h2>
</header>

<article>
    <p>Bridge understands 3 methods for authentication, which can vary depending on
the operation you wish to perform.</p>
<h3>HTTP Basic</h3>
<p>HTTP Basic authentication is supported as a fallback for situations where key
management is not available or specifically for use before a public key has
been associated with your user account.</p>
<p>Your <code>username</code> should simply be your registered email address.</p>
<p>Your <code>password</code> should be the SHA-256 hash of your password.</p>
<h3>ECDSA Signatures</h3>
<p>Once you have added a public ECDSA key to your account, you can use your
private key to sign messages to the server to avoid sending your credentials in
every request. This is the recommended authentication method.</p>
<p>The string that you are expected to sign differs depending on the type of
request. For POST, PUT, and PATCH requests, you must sign the JSON encoded body
of the request. For GET, DELETE, and OPTIONS requests, you must sign the raw
query string parameters.</p>
<p>In addition to the parameters required for each individual request, you must
also include a <code>__nonce</code> parameter. This value should be a string and must be
unique with every request. A common practice is to simply use UUID v4.</p>
<p>In addition to the request parameters and nonce, you will also sign the HTTP
method and request path. Ultimately the string you will sign will be:</p>
<pre class="prettyprint source"><code>&lt;METHOD>\n&lt;PATH>\n&lt;PARAMS>
</code></pre>
<p>For example, to generate a signature for creating a new storage bucket, you
will sign:</p>
<pre class="prettyprint source"><code>POST\n/buckets\n{&quot;storage&quot;:10,&quot;transfer&quot;:30,&quot;name&quot;:&quot;MyBucket&quot;,&quot;__nonce&quot;:1453222669376}
</code></pre>
<p>This tells the server that at Tue Jan 19 2016 11:57:49 GMT-0500 (EST), you
authorized a request to created a bucket called &quot;MyBucket&quot; with 10GB of capacity
and 30GB of transfer. This request cannot be replayed, since the nonce cannot
be reused.</p>
<p>Once you have generated the signature, it must be encoded as HEX and included
in the <code>x-signature</code> header.</p>
<p>In addition you must supply the public key for verifying the signature in the
<code>x-pubkey</code> header.</p>
<p>Bridge will first lookup the user account to which the supplied public key is
registered and then use it to verify the signature.</p>
<h3>OpenSSL Example</h3>
<p>Create ECDSA private key and print out public key</p>
<pre class="prettyprint source"><code>openssl ecparam -genkey -name secp256k1 -noout -outform DER -out private.key
openssl ec -inform DER -in private.key -noout -text
</code></pre>
<p>Register public key (HTTP basic auth)</p>
<pre class="prettyprint source"><code>curl -u user:password -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{ &quot;key&quot;: &quot;043874de22536decc5508257cc806a9e5af5e8be6a80056843d5c0c2b112903430f9a46c128ca17e30e2fb54f541416185dda2df878adbb90d66811452f4162125&quot; }' 'https://api.storj.io/keys'
</code></pre>
<p>Generate signature and use it for POST API call</p>
<pre class="prettyprint source"><code>printf &quot;POST\n/buckets\n{\&quot;storage\&quot;:10,\&quot;transfer\&quot;:30,\&quot;name\&quot;:\&quot;MyBucket\&quot;,\&quot;__nonce\&quot;:1453222669376}&quot; | openssl dgst -sha256 -hex -sign private.key -keyform DER
curl --header &quot;x-signature:3046022100e5b534eba11f19d4e3e92398e4ffdf8195041a7de13a1ffe8eb3baf66eb694b8022100982837e3b449fc9e4524009acd03800abf6447cf225a83d6f21bfa67a8326465&quot; --header &quot;x-pubkey:043874de22536decc5508257cc806a9e5af5e8be6a80056843d5c0c2b112903430f9a46c128ca17e30e2fb54f541416185dda2df878adbb90d66811452f4162125&quot; -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{&quot;storage&quot;:10,&quot;transfer&quot;:30,&quot;name&quot;:&quot;MyBucket&quot;,&quot;__nonce&quot;:1453222669376}' 'https://api.storj.io/buckets'
</code></pre>
<p>Generate signature and use it for GET API call</p>
<pre class="prettyprint source"><code>printf &quot;GET\n/buckets\n__nonce=1453222669376&quot; | openssl dgst -sha256 -hex -sign private.key -keyform DER
curl --header &quot;x-signature:304602210099eeb8f525ea1b1f385b8c3caba43a3e1efcc8fd839e8887528dd2fd6a4ae56b022100dfd0b7501d7fba047788fe0aef4d4868c8c493568f469d2cb42ecc998ad97ad6&quot; --header &quot;x-pubkey:04bb548b98f7d11d07384187fbdefc21f5c28b88c00ad0f1d3245e80d5f168273261558d4699f0a7d5cf2a82f937b50fe3f1c234256bb2d9f5e996e86576dc2d73&quot; -X GET 'https://api.storj.io/buckets?__nonce=1453222669376'
</code></pre>
<h3>Single Use Tokens</h3>
<p>There are 2 cases where signing the request body is not efficient for the client
and verifying the signature is not efficient for the server. This is when the
user wishes to push or pull data to or from a bucket.</p>
<p>If a file is quite large, the server would have to buffer it's entire contents
in order to verify the signature. This is where single-use tokens come into
play.</p>
<p>Instead of signing the upload request, you sign a request for a <code>token</code> that
corresponds to a bucket, then use that token in the <code>x-token</code> header in your
upload request. This also provides a way for users to grant access to others to
upload files to their bucket by generating a token for them (since anyone with
the token may upload the file to the bucket).</p>
<p>Tokens can be configured to expire (default is 5 minutes) and may only be used
once.</p>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>

<div class="modal fade" id="searchResults">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Search results</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<footer>


	<span class="copyright">
	Copyright 2016 Storj Labs
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a>
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>
<script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>

<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	$('pre').each(function(i, block) {
		hljs.highlightBlock(block);
	});

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			var id = $( heading ).attr( "id" );
			return id && id.replace(/\~/g, '-inner-').replace(/\./g, '-static-') || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->


<script type="text/javascript">
	$(document).ready(function() {
		SearcherDisplay.init();
	});
</script>

</body>
</html>